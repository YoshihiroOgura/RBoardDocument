<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>PWMサンプル - RBoardDocument</title>
    <link rel="shortcut icon" href="./image/bug.ico">
    <meta charset="utf-8"/>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176702602-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-176702602-1');
    </script>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/a11y-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
    <script type="text/javascript" src="./style.js"></script>
    <link href="https://use.fontawesome.com/releases/v5.11.0/css/all.css" rel="stylesheet">
  </head>
  <body>
    <div id="header"><h1> PWMサンプル </h1></div>
    <div id="main">
			<h3>PWM(外部LED)</h3>
			<pre><code  class="ruby">
pwm = PWM.new(16)
pwm.period_us(100)
while true
  pwm.duty_us(80)
  sleep 1
  pwm.duty_us(40)
  sleep 1
  pwm.duty_us(20)
  sleep 1
end
      </code></pre>
      <hr id="first_boader">
			<h3>圧電ブザー</h3>
			http://wiki.seeedstudio.com/Grove-Buzzer/
			<pre><code  class="ruby">
pwm = PWM.new(16, 4)
scale = [261,293,329,349,391,440,493]
i = 0
while true
  pwm.frequency(scale[i])
  sleep 1
  i = i + 1
  if(i == 7)
    i = 0
  end
end
			</code></pre>
			<h4>簡易mml再生</h4>
			<pre><code  class="ruby">
        TBL_FREQ = [261,293,329,349,391,440,493,
        523,587,659,698,783,880,987]
TBL_LENGTH = {1=>2000, 2=>1000, 4=>500, 8=>250}

$pwm = PWM.new(16, 4)

def tone( freq )
  if freq == 0
    $pwm.period_us(0)
    return
  end
​
  $pwm.frequency(freq)
end
​
​
def play( mml )
  mnote = nil
  mlength = 4
  octabe = 0
​
  mml.each_char {|ch|
    # 音階指示か？
    if "CDEFGABR".index(ch)
      play_sub( mnote, octabe, mlength )
      mnote = ch
      next
    end
​
    # 音長か？
    if TBL_LENGTH[ch.to_i]
      mlength = ch.to_i
      next
    end
​
    # オクターブ上下か？
    if ch == "<" || ch == ">"
      play_sub( mnote, octabe, mlength )
      if ch == "<"
        octabe += 1
      else
        octabe -= 1
      end
      mnote = nil
      next
    end
  }
  play_sub( mnote, octabe, mlength )
end
​
​
def play_sub( mnote, octabe, mlength )
  if !mnote
    return
  end
  if mnote == "R"
    sleep_ms( TBL_LENGTH[mlength] || 1 )
    return
  end
​
  idx = "CDEFGAB".index(mnote)
  if idx
    idx = octabe * 7 + idx
    if TBL_FREQ[idx]
      tone( TBL_FREQ[idx] )
      sleep_ms( TBL_LENGTH[mlength] || 1 )
      #tone( 0 )
    end
    return
  end
end
​
mml3 = "&lt;C8DE4&gt;C8DE4&lt;C8DE4&gt;C8DE4&lt;C8DE4&gt;C8DE4&lt;E8FG4EDC A8AAFDDEFGGGEC4R8 EF4&gt;A&lt;C8&gt;BAB&lt;C2"
​
play mml3
      </code></pre>
      <hr id="first_boader">
			<h3>SG90(サーボモータ)</h3>
			http://akizukidenshi.com/catalog/g/gM-08761/
			<pre><code  class="ruby">
pwm = PWM.new(16,6)
pwm.frequency(50)
while true
  pwm.duty_us(600)
  sleep(1)
  pwm.duty_us(850)
  sleep(1)
  pwm.duty_us(2300)
  sleep(1)
end
			</code></pre>
      </div>
        
      <div id="submenu">
        <script src="contents.js"></script>
      </div>
    </div>
	</body>
</html>