---
title: UARTサンプル
layout: sample_default
---

mruby/c 3.3 <a href="./mrubyc_class.html">標準IOクラス</a>対応<br>
UARTのGROVEポートはtxピンとrxピンが逆であることが今更判明。<br>
UARTのGROVEモジュールを使用する際には<a href="https://www.switch-science.com/catalog/6245/">スイッチサイエンス</a>や<a href="https://www.marutsu.co.jp/pc/i/829489/">マルツ</a>にて販売しているジャンパ線を使用して、<br>
黒：GND、赤：3.3V、白：Pin14、黄：Pin13へ接続してください。<br><br>
<h3>モジュール初期設定</h3>
シリアルコンソール経由(PC->RBoard->モジュール)でモジュールの初期設定を行う際に使用するRBoardのプログラムです。<br>
devのbaudはモジュールの初期値を指定して下さい。<br>
例：AMW037,BGX13Pなどは115200<br>

<pre><code  class="ruby">
usb = UART.new( 1, baud:19200 )
dev = UART.new( 2, baud:19200 )
while true
  # PC -> RBoard -> モジュール
  if(usb.can_read_line())
    dev.write(usb.gets())
  end

  # モジュール -> RBoard -> PC
  if(dev.can_read_line())
    usb.write(dev.gets())
    # usb.write("> ")
  end
end
</code></pre>

<h3>im920s</h3>
http://akizukidenshi.com/catalog/g/gM-13566/
<h4>文字列送信</h4>

<pre><code  class="ruby">
im = UART.new(19200)
while true
  im.puts("TXDA " + (23).to_s + "\r\n")
  sleep(5)
end
</code></pre>
<h4>文字列受信</h4>
<pre><code  class="ruby">
im = UART.new(19200)
while true
  puts(im.gets())
  sleep(5)
end
</code></pre>
<hr id="first_boader">
<h3>Bluetooth</h3>
https://www.switch-science.com/catalog/5794/<br>

setコマンドにて値の設定、getコマンドにて設定値の確認を行うことができます。<br>
コマンド　：https://docs.silabs.com/gecko-os/1/bgx/latest/commands<br>
パラメータ：https://docs.silabs.com/gecko-os/1/bgx/latest/variables<br>
例：ボーレート設定コマンド<br>
set ua b 19200<br>

Bluetooth5に対応したAndroidスマホを準備します。<br>
スマホアプリ「Serial Bluethooth Terminal」をインストール。<br>
モジュールの電源を入れる。（RBoardに接続するなど）<br>
スマホの設定→機器接続→新しい機器とペア設定する　からモジュールを登録。<br>
「Serial Bluethooth Terminal」を起動し、Devices→Bluetooth LE→モジュールの項目を長押しします。<br>
Edit→Custam→3つのUUIDをそれぞれ選択。<br>
右上の✓を押したら接続できるはずです。<br>
<pre><code  class="ruby">
bluetooth = UART.new(19200)
while true
  bluetooth.puts("aaaa\r\n")
  sleep(5)
end
</code></pre>
<h3>wifi</h3>
https://www.switch-science.com/catalog/5795/<br>
<pre><code  class="ruby">
cmd = "hge https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxx/exec?data1="
wifi = UART.new(19200)
wifi.puts("\r\n")
sleep(5)
while true
  wifi.puts(cmd + (1.to_s) + "\r\n")
  sleep(10)
  wifi.puts("stream_close 0\r\n")
  sleep(10)
end
</code></pre>